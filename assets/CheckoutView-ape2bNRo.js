import{d as q,r,u as D,B as R,c as _,a as o,b as a,e,y as c,f as S,_ as z,C as m,F as y,g as A,t as p,H as E,D as v,E as b,w as F,i as W,j,I as M}from"./index-DlkIuFvD.js";import{b as H,c as O}from"./order-SPW-NU_u.js";const G={class:"container"},J={class:"row justify-content-center"},K={class:"col-md-10"},Q={class:"row justify-content-center"},X={class:"col-md-10"},Y={key:0,class:"fw-bold mb-4 pt-3"},Z={key:1,class:"fw-bold mb-4 pt-3"},I={class:"row flex-row-reverse justify-content-center pb-5"},ee={class:"col-md-4"},te={class:"border p-4 mb-4"},se={class:"d-flex flex-column justify-content-center gap-2"},le=["src","alt"],oe={class:"w-100"},ae={class:"d-flex justify-content-between"},ne={class:"mb-0 fw-bold"},re={class:"mb-0"},de={class:"mb-0 fw-bold"},ie={class:"table mt-4 border-top border-bottom text-muted"},ue={class:"text-end border-0 px-0 pt-4"},ce={class:"d-flex justify-content-between mt-4"},me={class:"mb-0 h4 fw-bold"},pe={class:"col-md-6"},ve={class:"mb-2"},be={key:0,class:"text-danger small mt-1"},fe={class:"mb-2"},_e={key:0,class:"text-danger small mt-1"},ye={class:"mb-2"},xe={key:0,class:"text-danger small mt-1"},he={class:"mb-2"},we={key:0,class:"text-danger small mt-1"},ge={class:"mb-2"},ke={key:1,class:"card rounded-0"},Ve={class:"d-flex flex-column-reverse flex-md-row mt-4 justify-content-between align-items-md-center align-items-end w-100"},Ce=["disabled"],Pe=["disabled"],Te=q({__name:"CheckoutView",setup(Se){const N=M(),d=r(1),T=D(),{cart:i}=R(T),f=r(null),s=r({email:"",name:"",tel:"",address:"",message:""}),g=r(null),u=r(!1),$=()=>{u.value=!0,g.value?.click()},x=r(!1),B=async()=>{try{x.value=!0;const{message:n,...t}=s.value,w=await O({user:t,message:n});f.value=w.data.orderId,d.value=2}catch{alert("訂單建立失敗")}finally{x.value=!1}},k=_(()=>{const n=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;return s.value.email&&n.test(s.value.email.trim())}),V=_(()=>s.value.name&&s.value.name.trim()!==""),C=_(()=>{const n=/^09\d{8}$/;return s.value.tel&&n.test(s.value.tel)}),P=_(()=>s.value.address&&s.value.address.trim()!==""),L=()=>{if(f.value){d.value=2;return}$()},h=r(!1),U=async()=>{if(f.value)try{h.value=!0,await H(f.value),N.push("/checkout-success")}catch{alert("付款失敗")}finally{h.value=!1}};return(n,t)=>{const w=W("RouterLink");return a(),o("div",G,[e("div",J,[e("div",K,[S(z)])]),m(i)?.carts&&m(i)?.carts.length>0?(a(),o(y,{key:0},[e("div",Q,[e("div",X,[d.value===1?(a(),o("h3",Y,"輸入結帳資訊")):(a(),o("h3",Z,"選擇付款方式"))])]),e("div",I,[e("div",ee,[e("div",te,[e("div",se,[(a(!0),o(y,null,A(m(i)?.carts,l=>(a(),o("div",{key:l.id,class:"d-flex"},[e("img",{src:l.product.imageUrl,alt:l.product.title,class:"me-2",style:{width:"48px",height:"48px","object-fit":"cover"}},null,8,le),e("div",oe,[e("div",ae,[e("p",ne,p(l.product.title),1),e("p",re,"NT$"+p(l.final_total.toLocaleString("zh-TW")),1)]),e("p",de,"x"+p(l.qty),1)])]))),128))]),e("table",ie,[e("tbody",null,[e("tr",null,[t[6]||(t[6]=e("th",{scope:"row",class:"border-0 px-0 pt-4 font-weight-normal"},"小計",-1)),e("td",ue," NT$"+p(m(i)?.total.toLocaleString("zh-TW")),1)]),t[7]||(t[7]=e("tr",null,[e("th",{scope:"row",class:"border-0 px-0 pt-0 pb-4 font-weight-normal"},"付款方式"),e("td",{class:"text-end border-0 px-0 pt-0 pb-4"},"ApplePay")],-1))])]),e("div",ce,[t[8]||(t[8]=e("p",{class:"mb-0 h4 fw-bold"},"總計",-1)),e("p",me,"NT$"+p(m(i)?.final_total.toLocaleString("zh-TW")),1)])])]),e("div",pe,[d.value===1?(a(),o("form",{key:0,onSubmit:E(B,["prevent"])},[e("div",ve,[t[9]||(t[9]=e("label",{for:"email",class:"text-muted mb-0"},"電子信箱",-1)),v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.email=l),required:"",type:"email",class:"form-control",id:"email",placeholder:"example@gmail.com"},null,512),[[b,s.value.email]]),!k.value&&u.value?(a(),o("span",be," 請輸入正確的電子信箱 ")):c("",!0)]),e("div",fe,[t[10]||(t[10]=e("label",{for:"name",class:"text-muted mb-0"},"姓名",-1)),v(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.name=l),required:"",type:"text",class:"form-control",id:"name",placeholder:"王漂亮"},null,512),[[b,s.value.name]]),!V.value&&u.value?(a(),o("span",_e," 請輸入姓名 ")):c("",!0)]),e("div",ye,[t[11]||(t[11]=e("label",{for:"tel",class:"text-muted mb-0"},"手機",-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.tel=l),required:"",type:"text",class:"form-control",id:"tel",placeholder:"0912345678"},null,512),[[b,s.value.tel]]),!C.value&&u.value?(a(),o("span",xe," 請輸入正確的手機號碼 ")):c("",!0)]),e("div",he,[t[12]||(t[12]=e("label",{for:"address",class:"text-muted mb-0"},"地址",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.address=l),required:"",type:"text",class:"form-control",id:"address",placeholder:"高雄市新興區"},null,512),[[b,s.value.address]]),!P.value&&u.value?(a(),o("span",we," 請輸入正確的地址 ")):c("",!0)]),e("div",ge,[t[13]||(t[13]=e("label",{for:"message",class:"text-muted mb-0"},"留言",-1)),v(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.message=l),class:"form-control",rows:"3",id:"message",placeholder:"六角學院，只要你不放棄，我們就不放棄你 ... "},null,512),[[b,s.value.message]])]),e("button",{ref_key:"submitBtn",ref:g,type:"submit",class:"d-none"},null,512)],32)):(a(),o("div",ke,[...t[14]||(t[14]=[e("div",{class:"card-header bg-white border-0 py-3"},[e("p",{class:"mb-0 position-relative custom-checkout-label"},"Apple Pay")],-1)])])),e("div",Ve,[d.value===1?(a(),o(y,{key:0},[S(w,{to:"/cart",class:"text-dark mt-md-0 mt-3"},{default:F(()=>[...t[15]||(t[15]=[e("i",{class:"fas fa-chevron-left me-2"},null,-1),j("返回",-1)])]),_:1}),e("button",{onClick:L,disabled:x.value||!k.value||!V.value||!C.value||!P.value,type:"button",class:"btn btn-dark py-3 px-7"}," 下一步 ",8,Ce)],64)):(a(),o(y,{key:1},[e("button",{onClick:t[5]||(t[5]=l=>d.value=1),type:"button",class:"link-dark bg-transparent border-0 mt-md-0 mt-3 p-0"},[...t[16]||(t[16]=[e("i",{class:"fas fa-chevron-left me-2"},null,-1),j("返回 ",-1)])]),e("button",{onClick:U,disabled:h.value,type:"button",class:"btn btn-dark py-3 px-7"}," 結帳 ",8,Pe)],64))])])])],64)):c("",!0)])}}});export{Te as default};
